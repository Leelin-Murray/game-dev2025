
<html>
<body>

    <h1 align="center">t2a23-asyn-await-history-leelin</h1>
    <p>Run the demos below to see how **Legacy AJAX (XHR)**, **Promises (.then)**, and **Async/Await** all perform the same simple task: fetching JSON data from an API. The output box will show the fetched data.</p>

    <div style="margin-bottom: 20px;">
        <label for="api-select" style="font-weight: bold;">Select API:</label>
        <select id="api-select" style="margin-bottom: 10px; padding: 5px;">
            <option value="https://dog.ceo/api/breeds/image/random">Random Dog</option>
            <option value="https://api.thecatapi.com/v1/images/search">Random Cat</option>
            <option value="https://random-d.uk/api/v2/random">Random Duck</option>
            <option value="https://foodish-api.com/api/">Random Food</option>
            <option value="https://coffee.alexflipnote.dev/random.json">Random Coffee</option>
        </select><br>
        
        <button onclick="fetchAjaxXhr()">1. Run Legacy XHR (AJAX)</button>
        <button onclick="fetchPromiseChain()">2. Run Promises (.then)</button>
        <button onclick="fetchAsyncAwait()">3. Run Async/Await</button>
        <button onclick="document.getElementById('results').innerHTML = 'Output Cleared...';">Clear Output</button>
    </div>

    <div id="results" style="font-family: monospace; white-space: pre-wrap; padding: 10px; border: 1px solid #ccc; background-color: #f7f7f7;">
        Output Cleared...
    </div>

    <script>
        const output = document.getElementById('results');

        function getApiUrl() {
            return document.getElementById('api-select').value;
        }

        function getProxiedUrl(url) {
            if (url.includes("random-d.uk") || url.includes("foodish-api") || url.includes("coffee.alexflipnote")) {
                return "https://api.allorigins.win/get?url=" + encodeURIComponent(url);
            }
            return url;
        }

        function log(message) {
            output.innerHTML += `${message}\n`;
        }
        
        function logData(data, method, originalUrl) {
            // Handle proxy wrappers
            let finalData = data;
            if (data.contents && typeof data.contents === 'string') {
                try {
                    finalData = JSON.parse(data.contents);
                } catch(e) {}
            }

            const myJson = JSON.stringify(finalData, null, 2);
            log(`\n--- ${method} Result ---`);
            output.innerHTML += `<pre>${myJson}</pre>`;

            // Extract image based on API type
            let imageUrl = "";
            if (originalUrl.includes("dog.ceo")) imageUrl = finalData.message;
            else if (originalUrl.includes("thecatapi")) imageUrl = finalData[0].url;
            else if (originalUrl.includes("random-d.uk")) imageUrl = finalData.url;
            else if (originalUrl.includes("foodish-api")) imageUrl = finalData.image;
            else if (originalUrl.includes("coffee.alexflipnote.dev")) imageUrl = finalData.file;

            if (imageUrl) {
                output.innerHTML += `<img src="${imageUrl}" style="max-width: 300px; display: block; margin-top: 10px; border: 1px solid #ddd;">`;
            }
        }

        // --- 1. LEGACY AJAX (XMLHttpRequest) ---
        function fetchAjaxXhr() {
            log("\n--- XMLHttpRequest (XHR) Started ---");
            const url = getApiUrl();
            const proxyUrl = getProxiedUrl(url);
            const xhr = new XMLHttpRequest();

            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        logData(data, "XHR (AJAX)", url);
                        log("✅ XHR Complete: Requires manual JSON parsing and callback handling.\n------------------------------------------------------\n");
                    } catch (e) {
                        log('❌ XHR Error: JSON parsing failed.');
                    }
                } else {
                    log(`❌ XHR Error: HTTP status ${xhr.status}`);
                }
            };

            xhr.onerror = () => log("❌ XHR Error: A network error occurred.");
            xhr.open('GET', proxyUrl, true);
            xhr.send();
            log(`...XHR request sent to ${url}`);
        }

        // --- 2. PROMISES (Fetch API) ---
        function fetchPromiseChain() {
            log("\n--- Promises (.then) Started ---");
            const url = getApiUrl();
            const proxyUrl = getProxiedUrl(url);
            
            fetch(proxyUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                    return response.json(); 
                })
                .then(data => {
                    logData(data, "Promises (.then)", url);
                    log("✅ Promises Complete: Solves nesting with **.then() chaining**.\n------------------------------------------------------\n");
                })
                .catch(error => {
                    log(`❌ Promise Error: ${error.message}`);
                });

            log(`...Promise fetch initiated to ${url}`);
        }

        // --- 3. ASYNC/AWAIT (ES2017) ---
        async function fetchAsyncAwait() {
            log("\n--- Async/Await Started ---");
            const url = getApiUrl();
            const proxyUrl = getProxiedUrl(url);
            
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                
                const data = await response.json();
                logData(data, "Async/Await", url);
                log("✅ Async/Await Complete: Reads like synchronous code using familiar **try/catch**.\n------------------------------------------------------\n");

            } catch (error) {
                log(`❌ Async/Await Error: ${error.message}`);
            }
            log(`...Async/Await fetch initiated to ${url}`);
        }
    </script>

</body>
</html>
